"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getTerm = exports.getFullyQualifiedType = exports.getPropertyType = exports.getImplicitPropertyType = void 0;
/**
 * Gets the implicit property type based on the provided vocabulary service, context, and property name.
 *
 * @param vocabularyService - The vocabulary service.
 * @param context - The context containing recordType, termType, etc.
 * @param propertyName - The name of the property for which to get the type.
 * @returns The implicit property type or undefined if not found.
 */
function getImplicitPropertyType(vocabularyService, context, propertyName) {
    let baseType;
    if (context.recordType) {
        baseType = getFullyQualifiedType(vocabularyService, context.recordType);
    }
    if (!baseType && context.termType) {
        baseType = vocabularyService.getTerm(context.termType)?.type;
    }
    return getPropertyTypeFromBaseType(vocabularyService, baseType, propertyName);
}
exports.getImplicitPropertyType = getImplicitPropertyType;
/**
 * Gets the property type from the provided vocabulary service based on the specified record type and property name.
 *
 * @param vocabularyService - The vocabulary service.
 * @param recordType - The record type for which to retrieve the property type.
 * @param propertyName - The name of the property for which to get the type.
 * @returns The property type or undefined if not found.
 */
function getPropertyType(vocabularyService, recordType, propertyName) {
    if (!recordType) {
        return undefined;
    }
    const baseType = getFullyQualifiedType(vocabularyService, recordType);
    return getPropertyTypeFromBaseType(vocabularyService, baseType, propertyName);
}
exports.getPropertyType = getPropertyType;
/**
 * Gets the property type from the base type using the provided vocabulary service, base type, and property name.
 *
 * @param vocabularyService - The vocabulary service.
 * @param baseType - The base type from which to retrieve the property type.
 * @param propertyName - The name of the property for which to get the type.
 * @returns The property type or undefined if not found.
 */
function getPropertyTypeFromBaseType(vocabularyService, baseType, propertyName) {
    if (!baseType) {
        return undefined;
    }
    const derivedTypeNames = [...vocabularyService.getDerivedTypeNames(baseType)];
    for (const derivedTypeName of derivedTypeNames) {
        const propertyType = vocabularyService.getComplexTypeProperty(derivedTypeName, propertyName);
        if (propertyType) {
            return propertyType;
        }
    }
    return undefined;
}
/**
 *
 * @param service - The vocabulary service.
 * @param type - The type string to be qualified.
 * @returns The fully qualified type string or undefined if the namespace is not found.
 */
function getFullyQualifiedType(service, type) {
    const [simpleIdentifier] = type.split('.').slice(-1);
    const namespace = service.getVocabularyNamespace(type);
    if (namespace) {
        return [namespace, simpleIdentifier].join('.');
    }
    return undefined;
}
exports.getFullyQualifiedType = getFullyQualifiedType;
/**
 * Gets a term from the provided vocabulary service based on the specified vocabulary name or alias and term name.
 *
 * @param vocabularyService - The vocabulary service.
 * @param vocabularyNameOrAlias - The name or alias of the vocabulary.
 * @param termName - The name of the term to retrieve, if available.
 * @returns The retrieved term or undefined if not found.
 */
function getTerm(vocabularyService, vocabularyNameOrAlias, termName) {
    const vocabulary = vocabularyService.getVocabulary(vocabularyNameOrAlias);
    if (vocabulary && termName) {
        const fullyQualifiedTermName = [vocabulary.namespace, termName].join('.');
        const term = vocabularyService.getTerm(fullyQualifiedTermName);
        if (term) {
            return term;
        }
    }
    return undefined;
}
exports.getTerm = getTerm;
//# sourceMappingURL=type-resolver.js.map